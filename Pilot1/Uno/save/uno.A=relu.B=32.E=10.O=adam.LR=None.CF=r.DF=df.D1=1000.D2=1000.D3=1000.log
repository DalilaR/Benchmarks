[2018-08-16 13:37:06 38099] Params: {'single': False, 'dense_feature_layers': [1000, 1000, 1000], 'growth_bins': 0, 'save': 'save/uno', 'scaling': 'std', 'tb': False, 'export_data': None, 'cache': None, 'no_response_source': False, 'solr_root': '', 'activation': 'relu', 'batch_size': 32, 'train_sources': ['GDSC', 'CTRP', 'ALMANAC'], 'base_lr': None, 'validation_split': 0.2, 'shuffle': False, 'output_dir': '/home/jamal/Code/ECP/CANDLE/Benchmarks/Pilot1/Uno/Output/EXP000/RUN000', 'feature_subsample': 0, 'partition_by': None, 'by_drug': None, 'reduce_lr': False, 'dense': [1000, 1000, 1000], 'no_gen': False, 'cv': 1, 'drop': 0, 'cp': False, 'run_id': 'RUN000', 'residual': False, 'optimizer': 'adam', 'gpus': [], 'timeout': 3600, 'drug_median_response_min': -1, 'drug_median_response_max': 1, 'datatype': <class 'numpy.float32'>, 'batch_normalization': False, 'cell_types': None, 'train_bool': True, 'use_landmark_genes': False, 'learning_rate': None, 'experiment_id': 'EXP000', 'use_filtered_genes': False, 'loss': 'mse', 'no_feature_source': False, 'preprocess_rnaseq': 'none', 'drug_features': ['descriptors', 'fingerprints'], 'epochs': 10, 'by_cell': None, 'warmup_lr': False, 'rng_seed': 2018, 'max_val_loss': 1.0, 'test_sources': ['train'], 'cell_features': ['rnaseq'], 'verbose': False, 'logfile': None}
[2018-08-16 13:37:06 38099] Loading data from scratch ...
[2018-08-16 13:41:18 38099] Loaded 27769716 single drug dose response measurements
[2018-08-16 13:41:28 38099] Loaded 3686475 drug pair dose response measurements
[2018-08-16 13:41:31 38099] Combined dose response data contains sources: ['CCLE' 'CTRP' 'gCSI' 'GDSC' 'NCI60' 'SCL' 'SCLC' 'ALMANAC.FG'
 'ALMANAC.FF' 'ALMANAC.1A']
[2018-08-16 13:41:37 38099] Summary of combined dose response by source:
[2018-08-16 13:42:40 38099]             Drug2    Growth  Drug1  Sample  MedianDose
Source                                                
ALMANAC.1A    102    208605    102      60    7.000000
ALMANAC.FF     71   2062098     92      60    6.698970
ALMANAC.FG     29   1415772    100      60    6.522879
CCLE            0     93251     24     504    6.602060
CTRP            0   6171005    544     887    6.585027
GDSC            0   1894212    249    1075    6.505150
NCI60           0  18862308  52671      59    6.000000
SCL             0    301336    445      65    6.908485
SCLC            0    389510    526      70    6.908485
gCSI            0     58094     16     409    7.430334
[2018-08-16 13:42:46 38099] Combined raw dose response data has 3070 unique samples and 53520 unique drugs
[2018-08-16 13:42:46 38099] Limiting drugs to those with response min <= 1, max >= -1, span >= 0, median_min <= -1, median_max >= 1 ...
[2018-08-16 13:42:58 38099] Selected 47005 drugs from 53520
[2018-08-16 13:44:40 38099] Embedding RNAseq data source into features: 7 additional columns
[2018-08-16 13:45:02 38099] Loaded combined RNAseq data: (15196, 17751)
[2018-08-16 13:49:11 38099] Loaded combined dragon7 drug descriptors: (53507, 5271)
[2018-08-16 13:50:00 38099] Loaded combined dragon7 drug fingerprints: (53507, 2049)
[2018-08-16 13:50:00 38099] Filtering drug response data...
[2018-08-16 13:50:00 38099]   2373 molecular samples with feature and response data
[2018-08-16 13:50:00 38099]   46837 selected drugs with feature and response data
[2018-08-16 13:50:08 38099] Summary of filtered dose response by source:
[2018-08-16 13:50:22 38099]             Drug2   Growth  Drug1  Sample  MedianDose
Source                                               
ALMANAC.1A    101   206580    101      60    7.000000
ALMANAC.FF     71  2062098     92      60    6.698970
ALMANAC.FG     27  1293465     98      60    6.522879
CTRP            0  3397103    311     812    6.585027
GDSC            0  1019127    213     670    6.505150
[2018-08-16 13:50:28 38099] Grouped response data by drug_pair: 5587 groups
[2018-08-16 13:50:30 38099] Input features shapes:
[2018-08-16 13:50:30 38099]   dose1: (1,)
[2018-08-16 13:50:30 38099]   dose2: (1,)
[2018-08-16 13:50:30 38099]   response.source: (11,)
[2018-08-16 13:50:30 38099]   cell.rnaseq: (17750,)
[2018-08-16 13:50:30 38099]   drug1.descriptors: (5270,)
[2018-08-16 13:50:30 38099]   drug1.fingerprints: (2048,)
[2018-08-16 13:50:30 38099]   drug2.descriptors: (5270,)
[2018-08-16 13:50:30 38099]   drug2.fingerprints: (2048,)
[2018-08-16 13:50:30 38099] Total input dimensions: 32399
[2018-08-16 13:50:33 38099] CV fold 0: train data = 6363403, val data = 1614970, test data = 0
[2018-08-16 13:50:36 38099]   train groups (4469): ['PubChem.CID.7326481' 'PubChem.CID.1641662' 'PubChem.CID.2842253' ...
 'NSC.256942,NSC.609699' 'NSC.256942,NSC.673596' 'NSC.606869,NSC.681239']
[2018-08-16 13:50:38 38099]   val groups ({1118}): ['PubChem.CID.2729026' 'PubChem.CID.5566' 'PubChem.CID.36314' ...
 'NSC.256942,NSC.45923' 'NSC.256942,NSC.681239' 'NSC.256942,NSC.701852']
[2018-08-16 13:50:38 38099]   test groups ({0}): []
[2018-08-16 13:50:38 38099] Feature encoding submodel for drug.fingerprints:
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] Layer (type)                 Output Shape              Param #   
[2018-08-16 13:50:38 38099] =================================================================
[2018-08-16 13:50:38 38099] input_1 (InputLayer)         (None, 2048)              0         
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] dense_1 (Dense)              (None, 1000)              2049000   
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] dense_2 (Dense)              (None, 1000)              1001000   
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] dense_3 (Dense)              (None, 1000)              1001000   
[2018-08-16 13:50:38 38099] =================================================================
[2018-08-16 13:50:38 38099] Total params: 4,051,000
[2018-08-16 13:50:38 38099] Trainable params: 4,051,000
[2018-08-16 13:50:38 38099] Non-trainable params: 0
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] Feature encoding submodel for cell.rnaseq:
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] Layer (type)                 Output Shape              Param #   
[2018-08-16 13:50:38 38099] =================================================================
[2018-08-16 13:50:38 38099] input_2 (InputLayer)         (None, 17750)             0         
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] dense_4 (Dense)              (None, 1000)              17751000  
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] dense_5 (Dense)              (None, 1000)              1001000   
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] dense_6 (Dense)              (None, 1000)              1001000   
[2018-08-16 13:50:38 38099] =================================================================
[2018-08-16 13:50:38 38099] Total params: 19,753,000
[2018-08-16 13:50:38 38099] Trainable params: 19,753,000
[2018-08-16 13:50:38 38099] Non-trainable params: 0
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] Feature encoding submodel for drug.descriptors:
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] Layer (type)                 Output Shape              Param #   
[2018-08-16 13:50:38 38099] =================================================================
[2018-08-16 13:50:38 38099] input_3 (InputLayer)         (None, 5270)              0         
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] dense_7 (Dense)              (None, 1000)              5271000   
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] dense_8 (Dense)              (None, 1000)              1001000   
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] dense_9 (Dense)              (None, 1000)              1001000   
[2018-08-16 13:50:38 38099] =================================================================
[2018-08-16 13:50:38 38099] Total params: 7,273,000
[2018-08-16 13:50:38 38099] Trainable params: 7,273,000
[2018-08-16 13:50:38 38099] Non-trainable params: 0
[2018-08-16 13:50:38 38099] _________________________________________________________________
[2018-08-16 13:50:38 38099] Combined model:
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] Layer (type)                    Output Shape         Param #     Connected to                     
[2018-08-16 13:50:38 38099] ==================================================================================================
[2018-08-16 13:50:38 38099] input.cell.rnaseq (InputLayer)  (None, 17750)        0                                            
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] input.drug1.descriptors (InputL (None, 5270)         0                                            
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] input.drug1.fingerprints (Input (None, 2048)         0                                            
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] input.drug2.descriptors (InputL (None, 5270)         0                                            
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] input.drug2.fingerprints (Input (None, 2048)         0                                            
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] input.dose1 (InputLayer)        (None, 1)            0                                            
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] input.dose2 (InputLayer)        (None, 1)            0                                            
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] input.response.source (InputLay (None, 11)           0                                            
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] cell.rnaseq (Model)             (None, 1000)         19753000    input.cell.rnaseq[0][0]          
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] drug.descriptors (Model)        (None, 1000)         7273000     input.drug1.descriptors[0][0]    
[2018-08-16 13:50:38 38099]                                                                  input.drug2.descriptors[0][0]    
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] drug.fingerprints (Model)       (None, 1000)         4051000     input.drug1.fingerprints[0][0]   
[2018-08-16 13:50:38 38099]                                                                  input.drug2.fingerprints[0][0]   
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] concatenate_1 (Concatenate)     (None, 5013)         0           input.dose1[0][0]                
[2018-08-16 13:50:38 38099]                                                                  input.dose2[0][0]                
[2018-08-16 13:50:38 38099]                                                                  input.response.source[0][0]      
[2018-08-16 13:50:38 38099]                                                                  cell.rnaseq[1][0]                
[2018-08-16 13:50:38 38099]                                                                  drug.descriptors[1][0]           
[2018-08-16 13:50:38 38099]                                                                  drug.fingerprints[1][0]          
[2018-08-16 13:50:38 38099]                                                                  drug.descriptors[2][0]           
[2018-08-16 13:50:38 38099]                                                                  drug.fingerprints[2][0]          
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] dense_10 (Dense)                (None, 1000)         5014000     concatenate_1[0][0]              
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] dense_11 (Dense)                (None, 1000)         1001000     dense_10[0][0]                   
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] dense_12 (Dense)                (None, 1000)         1001000     dense_11[0][0]                   
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:38 38099] dense_13 (Dense)                (None, 1)            1001        dense_12[0][0]                   
[2018-08-16 13:50:38 38099] ==================================================================================================
[2018-08-16 13:50:38 38099] Total params: 38,094,001
[2018-08-16 13:50:38 38099] Trainable params: 38,094,001
[2018-08-16 13:50:38 38099] Non-trainable params: 0
[2018-08-16 13:50:38 38099] __________________________________________________________________________________________________
[2018-08-16 13:50:58 38099] Between random pairs in y_val:
[2018-08-16 13:50:58 38099]   mse: 0.5679
[2018-08-16 13:50:58 38099]   mae: 0.5284
[2018-08-16 13:50:58 38099]   corr: 0.0002
[2018-08-16 13:50:58 38099]   r2: -0.9996
[2018-08-16 13:50:58 38099] Data points per epoch: train = 6363403, val = 1614970
[2018-08-16 13:50:58 38099] Steps per epoch: train = 198857, val = 50468
